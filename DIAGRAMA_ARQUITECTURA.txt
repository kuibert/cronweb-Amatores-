╔═══════════════════════════════════════════════════════════════════════════════╗
║                    ARQUITECTURA CRONWEB AMATORES v2.0                         ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                              CAPA DE PRESENTACIÓN                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────┐         ┌──────────────┐         ┌──────────────┐       │
│  │  index.php   │         │   app.js     │         │  style.css   │       │
│  │  (HTML)      │◄────────┤  (JavaScript)│         │   (Estilos)  │       │
│  └──────────────┘         └──────┬───────┘         └──────────────┘       │
│                                   │                                          │
│                                   │ AJAX Requests                            │
│                                   ▼                                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                CAPA DE API                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                     cron_manager_v2.php                             │    │
│  │                      (API REST Endpoint)                            │    │
│  │                                                                      │    │
│  │  • Recibe peticiones HTTP                                           │    │
│  │  • Valida autenticación (auth.php)                                  │    │
│  │  • Enruta a controlador                                             │    │
│  │  • Retorna JSON                                                     │    │
│  └────────────────────────────┬───────────────────────────────────────┘    │
│                                │                                             │
└────────────────────────────────┼─────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CAPA DE CONTROLADORES                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                      CronController.php                             │    │
│  │                                                                      │    │
│  │  • list()        → Listar tareas                                    │    │
│  │  • add()         → Agregar tarea                                    │    │
│  │  • edit()        → Editar tarea                                     │    │
│  │  • delete()      → Eliminar tarea                                   │    │
│  │  • toggle()      → Habilitar/Deshabilitar                           │    │
│  │  • run()         → Ejecutar tarea                                   │    │
│  │  • getLogs()     → Obtener logs                                     │    │
│  │  • clearLogs()   → Limpiar logs                                     │    │
│  │  • export()      → Exportar tareas                                  │    │
│  │  • import()      → Importar tareas                                  │    │
│  └────────────────────────────┬───────────────────────────────────────┘    │
│                                │                                             │
└────────────────────────────────┼─────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CAPA DE SERVICIOS                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────┐              ┌──────────────────────────┐    │
│  │   CronService.php        │              │   LogService.php         │    │
│  │                          │              │                          │    │
│  │  • getAllJobs()          │              │  • addLog()              │    │
│  │  • getJob()              │              │  • getLogs()             │    │
│  │  • addJob()              │◄─────────────┤  • clearLogs()           │    │
│  │  • updateJob()           │              │                          │    │
│  │  • toggleJob()           │              └──────────────────────────┘    │
│  │  • deleteJob()           │                                               │
│  │  • executeJob()          │                                               │
│  │  • importJobs()          │                                               │
│  └────────────┬─────────────┘                                               │
│               │                                                              │
└───────────────┼──────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              CAPA DE MODELOS                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────────┐     │
│  │  CronJob.php     │  │ CronValidator.php│  │  CronExecutor.php    │     │
│  │                  │  │                  │  │                      │     │
│  │  • Propiedades   │  │  • validateField │  │  • execute()         │     │
│  │  • Getters       │  │  • validateRange │  │  • updateCrontab()   │     │
│  │  • Setters       │  │  • validateNumber│  │  • generateContent() │     │
│  │  • toArray()     │  │  • scheduleToStr │  │                      │     │
│  │  • toggle()      │  │                  │  │                      │     │
│  └──────────────────┘  └──────────────────┘  └──────────────────────┘     │
│                                                                              │
└────────────────────────────────┬─────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          CAPA DE PERSISTENCIA                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────┐  ┌──────────────────────┐  ┌─────────────────┐  │
│  │  cron_jobs_*.json    │  │ execution_logs_*.json│  │  System Crontab │  │
│  │  (Tareas por usuario)│  │  (Logs por usuario)  │  │  (Linux crontab)│  │
│  └──────────────────────┘  └──────────────────────┘  └─────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          CAPA DE CONFIGURACIÓN                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                         config/config.php                           │    │
│  │                                                                      │    │
│  │  • Rutas de archivos                                                │    │
│  │  • Límites y parámetros                                             │    │
│  │  • Usuarios permitidos                                              │    │
│  │  • Configuración de cron                                            │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════╗
║                              FLUJO DE DATOS                                   ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Usuario → app.js → cron_manager_v2.php → CronController → CronService
                                                              ↓
                                                         CronJob/Validator
                                                              ↓
                                                         CronExecutor
                                                              ↓
                                                    JSON Files / Crontab

╔═══════════════════════════════════════════════════════════════════════════════╗
║                         VENTAJAS DE LA ARQUITECTURA                           ║
╚═══════════════════════════════════════════════════════════════════════════════╝

✓ Separación de Responsabilidades  → Cada clase tiene una función específica
✓ Reutilización de Código          → Servicios y modelos reutilizables
✓ Testeable                        → Cada componente se puede probar aislado
✓ Escalable                        → Fácil agregar nuevas funcionalidades
✓ Mantenible                       → Código organizado y predecible
✓ Compatible                       → 100% compatible con versión anterior
